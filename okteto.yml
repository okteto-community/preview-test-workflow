build:
  app-dev:
    context: app
    target: base

  app-test:
    context: tests

deploy:
  compose: docker-compose.yml

dev:
  app:
    command: yarn dev
    environment:
      HOSTNAME: "0.0.0.0"
      NODE_ENV: "development"
    image: $OKTETO_BUILD_APP_DEV_IMAGE
    sync:
    - app:/app

test:
  e2e:
    # if the image is created outside of okteto replace with image name (e.g. demo/test-image:0.1.0)
    image: ${OKTETO_BUILD_APP_TEST_IMAGE}
    commands:
      - CYPRESS_BASE_URL=https://app-${OKTETO_NAMESPACE}.${OKTETO_DOMAIN} yarn cypress:run --config video=false,screenshotOnRunFailure=false